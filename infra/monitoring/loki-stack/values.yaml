loki:
  auth_enabled: false
  storage:
    type: filesystem
  persistence:
    enabled: true
    size: 10Gi
    storageClassName: local-storage
promtail:
  enabled: true
  securityContext:
    capabilities:
      add:
        - NET_ADMIN
        - NET_RAW
  config:
    clients:
      - url: http://loki.monitoring.svc.cluster.local:3100/loki/api/v1/push
    snippets:
      extraScrapeConfigs: |
        - job_name: envoy
          kubernetes_sd_configs:
            - role: pod
              namespaces:
                names:
                  - kube-system
              selectors:
                - role: pod
                  label: "k8s-app=cilium-envoy"
          relabel_configs:
            - source_labels: [__meta_kubernetes_pod_name]
              regex: cilium-envoy.*
              action: keep
            - source_labels: [__meta_kubernetes_pod_container_name]
              target_label: container_name
            - source_labels: [__meta_kubernetes_pod_name]
              target_label: pod_name
          pipeline_stages:
            - json:
                expressions:
                  request_headers: request_headers
                  request_path: request_path
                  response_code: response_code
                  user_agent: user_agent
                  authority: authority
                  method: method
                  bytes_sent: bytes_sent
                  duration: duration
                  referer: referer
            - json:
                expressions:
                  cf_ip: request_headers."Cf-Connecting-Ip"
                  cf_country: request_headers."Cf-Ipcountry"
                  cf_ray: request_headers."Cf-Ray"
                  cf_city: request_headers."CF-IPCITY"
                  cf_continent: request_headers."CF-IPCONTINENT"
                  cf_latitude: request_headers."CF-IPLATITUDE"
                  cf_longitude: request_headers."CF-IPLONGITUDE"
                  cf_region: request_headers."CF-IPREGION"
                  cf_device: request_headers."CF-Device-Type"
                  cf_visitor: request_headers."Cf-Visitor"
                  accept_language: request_headers."Accept-Language"
                  x_forwarded_for: request_headers."X-Forwarded-For"
            - labels:
                request_path:
                response_code:
                user_agent:
                authority:
                method:
                cf_ip:
                cf_country:
                cf_ray:
                cf_city:
                cf_continent:
                cf_region:
                cf_device:
                accept_language: 
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tunnel-credentials # Name of the ExternalSecret resource
  namespace: cloudflared # Namespace where the K8s secret will be created
spec:
  # Reference to the ClusterSecretStore (or SecretStore) configured for 1Password
  secretStoreRef:
    name: 1password-connect # Assumes a ClusterSecretStore named 1password-connect exists
    kind: ClusterSecretStore # Use SecretStore if it's namespace-scoped
  # Define the target Kubernetes secret
  target:
    name: tunnel-credentials # Name of the K8s Secret to create
    # Optionally control the template if needed, e.g., for specific labels/annotations
    # template:
    #   metadata:
    #     labels:
    #       some-label: value
  # Fetch data from 1Password
  data:
    - secretKey: credentials.json # Key name in the resulting K8s Secret
      remoteRef:
        key: vaults/homelabproxmox/items/cloudflared-proxmox # 1Password item path
        property: credentials.json # Corrected field name from 1Password item

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: longhorn-system
resources:
  - namespace.yaml
helmCharts:
  - name: longhorn
    repo: https://charts.longhorn.io
    version: 1.8.1
    releaseName: longhorn
    namespace: longhorn-system
    valuesFile: values.yaml
    skipTests: true # Skip test hooks
    includeCRDs: true
    # Set specific annotations to control ArgoCD behavior
    releaseName: longhorn
    # Add specific hooks management
    hooks:
      enabled: false # Disable all hooks

# Add specialized annotations for ArgoCD to control the sync
patchesJson6902:
  - target:
      kind: Application
      name: longhorn
    patch: |
      - op: add
        path: /metadata/annotations/argocd.argoproj.io~1hook
        value: Skip
      - op: add
        path: /metadata/annotations/argocd.argoproj.io~1sync-options
        value: SkipDryRunOnMissingResource=true,ServerSideApply=true,Prune=false